<div class="row">
    <%= form_with(model: product, data: {controller: 'product nested-form', nested_form_wrapper_selector_value: '.nested-form-wrapper'}, class: 'col-md-8') do |form| %>
        <%= render "shared/errors", object: product%>

        <div class="card">
            <div class="card-header py-3 px-3 border-bottom">
            <ul class="nav nav-pills" id="productEditTab" role="tablist">
                <li class="nav-item border border-primary rounded" role="presentation">
                <a class="nav-link active" id="productEditMain-tab" data-bs-toggle="tab" data-bs-target="#productEditMain">Основные</a>
                </li>
                <li class="nav-item border border-primary rounded" role="presentation">
                <a class="nav-link" id="productEditProperty-tab" data-bs-toggle="tab" data-bs-target="#productEditProperty" data-action= "click->product#tab_click">Параметры</a>
                </li>
                <% if !form.object.new_record? %>
                <li class="nav-item border border-primary rounded" role="presentation">
                <a class="nav-link" id="productEditHistory-tab" data-bs-toggle="tab" data-bs-target="#productEditHistory">История</a>
                </li>
                <% end %>
            </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <div class="tab-pane active" id="productEditMain" role="tabpanel" aria-labelledby="productEditMain-tab">
                        <%= render "form_data", f: form %>
                    </div>
                    <div class="tab-pane" id="productEditProperty" role="tabpanel" aria-labelledby="productEditProperty-tab">
                        
                        <%= render "props_nested", f: form %>
                        <%# link_to "<i data-feather='plus'></i> #{Property.model_name.human}".html_safe, 
                                    new_prop_path(product_id: product.id), class: 'btn btn-primary', data: {turbo_frame: dom_id(Prop.new), action: "autosave#save"} %>
                        <%# render "props/property_lines", f: form %>
                    </div>
                    <% if !form.object.new_record? %>
                    <div class="tab-pane" id="productEditHistory" role="tabpanel" aria-labelledby="productEditHistory-tab">
                        <%= render "shared/history", f: form %>
                    </div>
                    <% end %>
                </div>
            </div>
            <div class="card-footer">
                <%= form.submit class: "btn btn-primary" %>
                <%= link_to t('back'), products_path, class: "btn btn-outline-primary" %>
            </div>
        </div>

    <% end %>

    <div class="col-md-4">
        <% if product.barcode.present? %>
            <div class="card">
                <div class="card-body">
                    <%= product.get_barcode %>
                </div>
            </div>
        <% end %>

        <div class="card">
            <div class="card-body">
                <% if product.new_record?%>
                    <p>Сохраните товар</p>
                <% else %>
                    <%= turbo_frame_tag "images_product_#{@product.id}" do %>
                        <%= render 'dropzone' %>
                    <% end %>
                <% end %>
            </div>
        </div>
    </div>

</div>
